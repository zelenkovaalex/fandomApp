@allFandoms = [
  { name: 'Атлантида', description: 'Тайны древней цивилизации, скрытой под водой.' },
  { name: 'Шерлок', description: 'Гениальный детектив раскрывает самые сложные преступления.' },
  { name: 'Star Wars', description: 'Давным-давно, в далекой-далекой галактике...' },
  { name: 'My Little Pony', description: 'Дружба - это чудо!' },
  { name: 'Доктор Кто', description: 'Путешествия во времени и пространстве с эксцентричным Доктором.' },
  { name: 'Ван Пис', description: 'Приключения пиратов в поисках легендарного сокровища.' },
  { name: 'Голодные игры', description: 'Борьба за выживание в жестоком мире Панема.' },
  { name: '1984', description: 'Антиутопический мир тотального контроля и подавления личности.' },
  { name: 'Игра Престолов', description: 'Борьба за власть в Вестеросе, где играют, либо умирают.' },
  { name: 'Хроники Нарнии', description: 'Волшебная страна, где животные говорят и добро сражается со злом.' },
  { name: 'Звёздный десант', description: 'Борьба человечества с арахнидами в далеком космосе.' },
  { name: 'Атака Титанов', description: 'Битва человечества за выживание против гигантских титанов.' },
  { name: 'DC Comics', description: 'Мир супергероев, спасающих человечество от зла.' },
  { name: 'Властелин Колец', description: 'Братство кольца отправляется в опасное путешествие, чтобы уничтожить Кольцо Всевластия.' },
  { name: 'Marvel', description: 'Вселенная супергероев, где каждый обладает невероятными способностями.' },
  { name: 'Баскетбол Куроко', description: 'История о невероятных баскетболистах, стремящихся к победе.' },
  { name: 'Мы', description: 'Антиутопия, где люди - лишь номера в тоталитарном государстве.' },
  { name: 'Гарри Поттер', description: 'Приключения юного волшебника в школе Хогвартс.' },
  { name: 'Наруто', description: 'История о молодом ниндзя, стремящемся стать Хокаге.' },
  { name: 'Сумерки', description: 'Любовь между вампиром и обычной девушкой.' },
  { name: 'Клуб романтики', description: 'Интерактивные истории о любви и приключениях.' },
  { name: 'Космическая Одиссея', description: 'Философское путешествие к истокам человечества и за его пределы.' },
  { name: 'Однажды в сказке', description: 'Сказочные персонажи оказываются в реальном мире.' },
  { name: 'Великолепный век', description: 'Интриги и любовь в Османской империи времен правления Сулеймана Великолепного.' }
]
            
@nicknames = [ "sashaiskatel", "igorveber", "spookypirate", 
                "flobara", "dachanacha", "nebozhitel", 
                "lenabistra", "pupsik", "kreativnyy", 
                "misterx", "lazernyy_rytsar", "zabavnyj_kot", 
                "snezhnyj_lev", "koshka_v_sapogah", "veteran_gamer", 
                "tvorcheskiy_duh", "mystic_wanderer", 
                "luna_iz_mira", "neon_ryba", "kultura_vechera" ]

@cities = [ "калининград", "санкт-петербург", 
          "владивосток", "париж", "москва", 
          "тюмень", "екатеринбург", "новосибирск", 
          "самара", "ростов-на-дону", "казань", 
          "нижний новгород", "челябинск", "ульяновск", 
          "воронеж", "пермь", "сочи", 
          "архангельск", "кострома", "волгоград" ]

@bios = [
          "люблю гулять и пиццу",
          "самый преданный фанат своего фандома (спорьте с воздухом, кто не согласен)",
          "продам твою душу за початок кукурузы",
          "геодезист",
          "люблю прикольные картинки и ходилки",
          "профессиональный исследователь человеческих душ",
          "мечтатель с головой в облаках",
          "коллекционер забавных мемов",
          "жизнь — это игра, а я её главный герой",
          "путешественник по мирам книг и фильмов",
          "всегда готов к новым приключениям",
          "обожаю кофе и долгие разговоры",
          "просто человек с хорошим чувством юмора",
          "в поисках идеального пончика",
          "собираю впечатления, а не вещи",
          "вдохновляюсь природой и искусством",
          "фанат настольных игр и вечеринок",
          "люблю танцевать под дождём",
          "жизнь — это искусство, а я — художник",
          "всегда на стороне добра и справедливости",
          "покоритель виртуальных миров"
        ]

@trail_titles = {
  'Атлантида' => [
    "Тайны подводного мира Атлантиды",
    "Путешествие к затонувшей цивилизации",
    "Загадки кристаллов Атлантиды"
  ],
  'Шерлок' => [
    "Шерлок и дело о пропавшем артефакте",
    "Тайна Бейкер-стрит",
    "Загадочные шифры Шерлока"
  ],
  'Star Wars' => [
    "Звёздные приключения: путь к свету",
    "Сила и тьма: тропа джедая",
    "Восстание против Империи"
  ],
  'My Little Pony' => [
    "Пони на границе реальности",
    "Магия дружбы в Эквестрии",
    "Приключения искателей приключений"
  ],
  'Доктор Кто' => [
    "Время и пространство с Доктором",
    "Встреча с Далеками",
    "Парадоксы времени Доктора"
  ],
  'Ван Пис' => [
    "Приключения на море с Ван Писом",
    "В поисках легендарного сокровища",
    "Битва за свободу с Ван Писом"
  ],
  'Голодные игры' => [
    "Выживание в Капитолии",
    "Битва за справедливость в Панеме",
    "Восстание против угнетения"
  ],
  '1984' => [
    "Борьба за свободу мысли",
    "Бегство от Большого Брата",
    "Поиск правды в мире лжи"
  ],
  'Игра Престолов' => [
    "Восхождение на Железный трон",
    "Интриги и предательства в Вестеросе",
    "Битва за власть семи королевств"
  ],
  'Хроники Нарнии' => [
    "Путешествие по Нарнии: за пределами шкафчика",
    "Битва за Нарнию",
    "Волшебство и приключения в Нарнии"
  ],
  'Звёздный десант' => [
    "Звёздный десант: битва за Землю",
    "Миссия на Марс",
    "Борьба с арахнидами в космосе"
  ],
  'Атака Титанов' => [
    "Последняя надежда человечества",
    "Битва с гигантами",
    "Тайны стены и титанов"
  ],
  'DC Comics' => [
    "Супергерои против злодеев: битва за Готэм",
    "Лига справедливости: объединение сил",
    "Приключения Бэтмена и Супермена"
  ],
  'Властелин Колец' => [
    "Путешествие Братства кольца",
    "Сражение за Средиземье",
    "Тайны кольца и его силы"
  ],
  'Marvel' => [
    "Мстители: объединение против зла",
    "Человек-паук: борьба с преступностью в Нью-Йорке",
    "Тайны вселенной Marvel"
  ],
  'Баскетбол Куроко' => [
    "Путь к чемпионству: баскетбольные баталии",
    "Команда тени: секреты успеха",
    "Сила дружбы на корте"
  ],
  'Мы' => [
    "Жизнь под контролем: борьба за индивидуальность",
    "Система, которая нас подавляет",
    "Поиск свободы в мире безликих"
  ],
  'Гарри Поттер' => [
    "Приключения в Хогвартсе: магия и дружба",
    "Секреты волшебного мира",
    "Битва с Темным Лордом"
  ],
  'Наруто' => [
    "Путь ниндзя: от изгнанника до героя",
    "Друзья и враги на пути к Хокаге",
    "Секреты ниндзя: сила дружбы"
  ],
  'Сумерки' => [
    "Любовь и опасность: вампиры и люди",
    "Скрытые тайны вампирского мира",
    "Борьба за любовь в условиях опасности"
  ],
  'Клуб романтики' => [
    "Истории любви: выбор судьбы",
    "Приключения и романтика в каждой истории",
    "Сердечные испытания и неожиданные повороты"
  ],
  'Космическая Одиссея' => [
    "Путешествие к звёздам: философские размышления",
    "Поиск смысла жизни в космосе",
    "Исследование границ человечества"
  ],
  'Однажды в сказке' => [
    "Сказочные персонажи в нашем мире",
    "Приключения героев из сказок",
    "Любовь и интриги в мире сказок"
  ],
  'Великолепный век' => [
    "Интриги во дворце Османской империи",
    "Любовь и политика времен Сулеймана",
    "Секреты великого правления"
  ]
}

@raw_text = "Путешествие — это открытие новых горизонтов и возможность увидеть мир с другой стороны. 
            Когда мы отправляемся в путь, нас ожидает множество незнакомых мест и людей. 
            Каждый день приносит новые впечатления, которые обогащают наш опыт. 
            Путешествие также помогает нам лучше понять самих себя. 
            Мы сталкиваемся с неожиданными ситуациями, которые требуют от нас гибкости и смекалки. 
            Эти моменты учат нас принимать решения в условиях неопределенности. 
            Мы развиваем навыки управления стрессом и становимся более уверенными в своих силах. 
            Путешествуя, мы учимся ценить разнообразие культур и традиций. 
            Это не только физическое перемещение, но и глубокое внутреннее преобразование. 
            В конечном итоге, каждое путешествие становится частью нашей истории и формирует наше восприятие мира."

@words = @raw_text.downcase.gsub(/[—.—,«»:;()]/, '').gsub(/  /, ' ').split(' ')

def reset_db
  Rake::Task['db:drop'].invoke
  Rake::Task['db:create'].invoke
  Rake::Task['db:migrate'].invoke
end

def seed
  reset_db
  create_fandom
  create_users(10)
  create_trail(2...5)
  create_comments(2..4)
end

def create_fandom
  @allFandoms.each do |fandom_data|
    Fandom.create!(name: fandom_data[:name], description: fandom_data[:description])
    puts "Fandom with name #{fandom_data[:name]} created"
  end
  puts "Total fandoms created: #{Fandom.count}"
end

def upload_random_avatar(profile)
  image_directory = Rails.root.join('app', 'assets', 'images', 'people')
  image_files = Dir.glob("#{image_directory}/*.{jpg,jpeg,png,gif}")
                   .select { |file| File.file?(file) }

  raise "No images found in #{image_directory}" if image_files.empty?

  random_image_path = image_files.sample
  profile.avatar = File.open(random_image_path) # Присваиваем файл напрямую атрибуту avatar

  puts "Avatar assigned from #{random_image_path}" if profile.avatar.present?
    rescue => e
  puts "Error assigning avatar: #{e.message}" # Логируем ошибки
end

def upload_random_trail_image(trail)
  image_directory = Rails.root.join('app', 'assets', 'images', 'trails')
  image_files = Dir.glob("#{image_directory}/*.{jpg,jpeg,png,gif}")
                   .select { |file| File.file?(file) }

  raise "No images found in #{image_directory}" if image_files.empty?

  random_image_path = image_files.sample

  begin
    file = File.open(random_image_path)
    trail.trail_image = file # Присваиваем файл атрибуту trail_image
    puts "Trail image assigned from #{random_image_path}"
    file.close # Закрываем файл
  rescue => e
    puts "Error assigning trail image: #{e.message}"
  end
end

def create_users(quantity)

  created_emails = []
  created_nicknames = []

  quantity.times do |i|
     email = "user#{i}@email.com"

    # Check for duplicate email
    while created_emails.include?(email)
      email = "user#{rand(1000)}@email.com"
    end

    # Generate unique nickname
    nickname = @nicknames.sample
    while created_nicknames.include?(nickname)
      nickname = @nicknames.sample
      if @nicknames.all? { |n| created_nicknames.include?(n) }
        raise "All nicknames are already used!"
      end
    end

    user_data = {
      email: email,
      password: "passpass"
    }

    user_data[:admin] = true if i == 0

    user = User.create!(user_data)
    created_emails << email
    puts "User created with id #{user.id}"
    puts "User created with JTI #{user.jti}"

    profile_data = {
      user_id: user.id,
      nickname: nickname,
      bio: @bios.sample,
      city: @cities.sample,
      fandom_id: Fandom.all.sample.id
    }

    profile = Profile.new(profile_data)

    upload_random_avatar(profile) # Загружаем аватар

    profile.save! # Сохраняем профиль с аватаром
    puts "Profile created for user with id #{user.id}: #{profile.nickname}"

    create_fandoms_for_user(user)

    # Выбираем случайные фандомы для профиля
    random_fandoms = Fandom.all.sample(rand(2..5)) # Assign 2 to 5 random fandoms

    # Присоединяем фандомы к профилю
    profile.fandoms << random_fandoms

    # Можно распечатать, какие фандомы были присоединены
    random_fandoms.each do |fandom|
      puts "Fandom #{fandom.name} assigned to profile with id #{profile.id}"
    end
  end
end

def create_fandoms_for_user(user)
  random_fandoms = Fandom.all.sample(rand(2..5))  
    random_fandoms.each do |fandom|   
      puts "Fandom #{fandom.name} assigned to user #{user.id}"   
    end  
end 

def get_random_bool
  [true, false].sample
end

def get_random_time
  (30...90).to_a.sample
end

def get_random_level
  (1...10).to_a.sample
end

def create_sentence
  sentence_words = []

  (10..20).to_a.sample.times do
    sentence_words << @words.sample
  end
  sentence = sentence_words.join(' ').capitalize + '.'
end

def create_trail(quantity)
  if User.count == 0
    puts "There are no users."
    return
  end

  # Каталог с изображениями для trails
  image_directory = Rails.root.join('app', 'assets', 'images', 'trails')
  image_paths = Dir.glob("#{image_directory}/*.{jpg,jpeg,png,gif}")
                   .select { |file| File.file?(file) }

  # Проверяем, есть ли изображения в каталоге
  if image_paths.empty?
    puts "No images found in directory: #{image_directory}"
    return
  end

  Fandom.all.each do |fandom|
    rand(quantity).times do
      if fandom.present?
        user = User.all.sample

        # Получаем массив названий trails для текущего фандома
        fandom_titles = @trail_titles[fandom.name]

        # Если для фандома нет названий, выводим сообщение и переходим к следующему фандому
        if fandom_titles.nil? || fandom_titles.empty?
          puts "No trail titles found for fandom: #{fandom.name}"
          next # Переходим к следующему фандому
        end

        trail = fandom.trails.new(
          title: fandom_titles.sample, # Выбираем случайное название
          fandom: fandom,
          city: @cities.sample,
          user: user,
          trail_time: get_random_time,
          trail_level: get_random_level,
          body: "рандомный текст",
          public: get_random_bool
        )

        # Загружаем случайное изображение
        upload_random_trail_image(trail)

        if trail.save # Сохраняем trail (важно!)
          puts "Trail with title #{trail.title} for fandom #{trail.fandom.name} just created"
        else
          puts "Error creating trail: #{trail.errors.full_messages.join(', ')}"
        end
      end
    end
  end

  puts Trail.count
end

def create_comments(quantity)
  Trail.all.each do |trail|
    quantity.to_a.sample.times do
      user = User.all.sample
      comment = Comment.create(
        trail_id: trail.id,
        user_id: user.id,
        body: create_sentence
      )
      puts "Comment with id #{comment.id} for trail with id #{comment.trail.id} created by user #{user.email}"
    end
  end
end

def create_comment_replies(quantity)
  Comment.all.each do |comment|
    if rand(1..3) == 1
      comment_reply = comment.replies.create(trail_id: comment.trail_id, body: create_sentence)
      puts "Comment reply with id #{comment_reply.id} for pin with id #{comment_reply.trail.id} just created"
    end
  end
end


seed